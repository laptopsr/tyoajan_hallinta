<!DOCTYPE html>

<html>
    <head>
        <meta charset="utf-8" />
	<meta http-equiv="Content-Security-Policy" content="default-src *; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval'">
        <meta name="format-detection" content="telephone=no" />
        <meta name="msapplication-tap-highlight" content="no" />
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height" />
        <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" />
        <!--<link rel="stylesheet" type="text/css" href="css/bootstrap-switch.css" />-->
        <link rel="stylesheet" type="text/css" href="css/index.css" />

        <script type="text/javascript" src="js/jquery-1.11.2.min.js"></script>
  	<script src="js/bootstrap.min.js"></script>
  	<!--<script src="js/bootstrap-switch.js"></script>-->

    	<script type="text/javascript" charset="utf-8" src="cordova.js"></script>
 	<script type="text/javascript" src="js/domain.js"></script>
	<script type="text/javascript" src="js/BigInteger.min.js"></script>
 	<script type="text/javascript" src="js/nfc.js"></script>
 	<script type="text/javascript" src="js/camera.js"></script>




<script type="text/javascript">



    var pictureSource; // picture source
    var destinationType; // sets the format of returned value 
    var newImage;

    // Wait for Cordova to connect with the device
    document.addEventListener("deviceready", onDeviceReady, false);

    // Cordova is ready to be used!
    function onDeviceReady() {
        pictureSource = navigator.camera.PictureSourceType;
        destinationType = navigator.camera.DestinationType;
    }

    // Called when a photo is successfully retrieved
    function onPhotoDataSuccess(imageURI) {

  	jQuery("#smallImage").attr("src", imageURI).show();

	document.getElementById('CaptureButtons').style.display = 'none';
	document.getElementById('submitTila').style.display = 'block';

	newImage = imageURI;
    }

    // Called when a photo is successfully retrieved
    function onPhotoURISuccess(imageURI) {

  	jQuery("#smallImage").attr("src", imageURI).show();
	/*
	var smallImage = document.getElementById('smallImage');
	smallImage.style.display = 'block';
	smallImage.src = "data:image/jpeg;base64," + imageData;
	*/
	document.getElementById('CaptureButtons').style.display = 'none';
	document.getElementById('submitTila').style.display = 'block';

	newImage = imageURI;

    }

    // A button will call this function
    function capturePhoto() {
        // Take picture using device camera and retrieve image as base64-encoded string
        navigator.camera.getPicture(onPhotoDataSuccess, onFail, {
            quality : 100,
	    encodingType: Camera.EncodingType.JPEG,
      	    targetHeight: 1024,
    	    targetWidth: 1024,
            destinationType : destinationType.FILE_URI,
	    correctOrientation: true
        });
    }

    // A button will call this function
    //
    function capturePhotoEdit() {
        // Take picture using device camera, allow edit, and retrieve image as base64-encoded string  
        navigator.camera.getPicture(onPhotoDataSuccess, onFail, {
            quality : 20,
            allowEdit : true,
            destinationType : destinationType.DATA_URL
        });
    }

    // A button will call this function
    function getPhoto(source) {
        // Retrieve image file location from specified source
        navigator.camera.getPicture(onPhotoURISuccess, onFail, {
            quality : 60,
	    encodingType: Camera.EncodingType.JPEG,
      	    targetHeight: 1024,
    	    targetWidth: 1024,
            destinationType : destinationType.FILE_URI, //FILE_URI
            sourceType : source
        });
    }

    // Called if something bad happens.
    function onFail(message) {
        alert('Failed because: ' + message);
    }
    function savePhoto() {


	jQuery("#camButtons").hide();
	jQuery("#otsikko").hide();
	jQuery("#osoiteFromBase").hide();
	jQuery("#submitTila").hide();
	jQuery("#odotta").show();

	var domain = document.getElementById('domain').value;
	var email = document.getElementById('email').value;
	var salasana = document.getElementById('salasana').value;
	var kohdenID = document.getElementById('kohdenID').value;
	//var server = "https://etunti.fi";
	var path = server + "/index.php/api/mob/tiedosto?dom="+domain;

	var win = function (r) {
	    console.log("Code = " + r.responseCode);
	    console.log("Response = " + r.response);
	    console.log("Sent = " + r.bytesSent);
	    if(r.responseCode){
		alert('Kiitos!\nKuva lähetetty onnistuneesti');
		window.location.href='camera.html';
	    }
	}
	
	var fail = function (error) {
	    alert("An error has occurred: Code = " + error.code);
	    console.log("upload error source " + error.source);
	    console.log("upload error target " + error.target);
	
	    document.getElementById('result2').innerHTML="An error has occurred: Code = " + error.code +
					"upload error source " + error.source + 
					"upload error target " + error.target;
	
	}
	
	         var options = new FileUploadOptions();
	          options.fileKey="file";
	          options.fileName=newImage.substr(newImage.lastIndexOf('/')+1);
	          options.mimeType="image/jpeg";
	
	
	          var params = new Object();
	          params.kohdenID = kohdenID;
	          params.email = email;
	          params.salasana = salasana;
	
	          options.params = params;
	          options.chunkedMode = false;
	
	          var ft = new FileTransfer();
	          ft.upload(newImage, path, win, fail, options);
	
    }



</script>



        <title>ETUNTI</title>
    </head>
    <body>


<div class="container-fluid">

  <div class="row">
    <div class="col-lg-12 full">
     <div class="head"> 
	<img src="img/logo-black.png" class="logo">
     </div>
	
	<h2 id="LangKuvienLahettaminen"></h2>

	<center><div id="odotta"></div></center>
	<div id="domainBlokki" style="display:none">
		<div id="dm"></div>
	</div>

	<br>
     	<div id="osoiteFromBase"></div>

	<input type="text" class="form-control input-sm" id="os" placeholder="osoite">
	<div id="getListFromServer"></div>
	<input type="hidden" id="kohdenID" value="0">


	<div id="camButtons" style="display:none">

	  <div id="CaptureButtons">
	  <br>
	    <button class="btn btn-success btn-group-justified" onclick="capturePhoto();" id="fromCamera"></button>
	    <br>
	    <button class="btn btn-success btn-group-justified" onclick="getPhoto(pictureSource.PHOTOLIBRARY);" id="fromLibrary"></button>
	    <br>
	    <button class="btn btn-success btn-group-justified" onclick="getPhoto(pictureSource.SAVEDPHOTOALBUM);" id="fromAlbum"></button>
	    <br>
	  </div>

	  <div id="submitTila" style="display:none">	
	    <img style="display: none; height: 150px;" id="smallImage"
	        src="" class="thumbnail"/>
	    <img style="display: none;" id="largeImage" src="" />
	
	    <br>
	    <button class="btn btn-primary btn-group-justified" onclick="savePhoto();">Lähetä kuva</button>
	  </div>

	</div>


	    <div id="tietoja" style="display:none">
	       <label>tag</label>
	       <input type="text" id="tagginro" class="form-control" readonly="yes">
	       <label>gps</label>
	       <input type="text" id="location" class="form-control" readonly="yes">
	    </div>

	<BR>
	    <div id="result2"></div>
	    <div id="result3"></div>
	<BR>

    </div>
  </div>

</div>

<br><br><br><br>

		<div id="footlinks"></div>

    </body>
</html>
